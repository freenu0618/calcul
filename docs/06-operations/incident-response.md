# 장애 대응 가이드

**버전**: v1.0.0
**최종 수정**: 2026-01-28
**상태**: Approved

---

## 개요

Paytools 서비스 장애 발생 시 대응 절차를 안내합니다.

---

## 1. 장애 등급 분류

| 등급 | 설명 | 대응 시간 | 예시 |
|------|------|----------|------|
| **Critical** | 서비스 전체 중단 | 즉시 | 백엔드 다운, DB 연결 불가 |
| **Major** | 핵심 기능 장애 | 1시간 내 | 급여 계산 실패, 로그인 불가 |
| **Minor** | 부분 기능 장애 | 24시간 내 | UI 오류, 일부 페이지 느림 |

---

## 2. 장애 대응 절차

### 2.1 즉시 확인

```bash
# 1. 백엔드 헬스 체크
curl https://calcul-production.up.railway.app/actuator/health

# 2. 프론트엔드 접속 확인
curl -I https://paytools.work

# 3. Railway 로그 확인
# Railway Dashboard → Deployments → View Logs
```

### 2.2 원인 파악

| 증상 | 가능 원인 | 확인 방법 |
|------|----------|----------|
| 502 Bad Gateway | 백엔드 다운 | Railway 배포 상태 |
| 503 Service Unavailable | 과부하 | Railway 메트릭 |
| DB 연결 실패 | PostgreSQL 장애 | Railway DB 상태 |
| CORS 에러 | 환경 변수 | ALLOWED_ORIGINS |

### 2.3 복구 조치

**백엔드 재시작**:
1. Railway Dashboard → Deployments
2. 최신 배포 선택
3. **Redeploy** 클릭

**롤백**:
1. Railway Dashboard → Deployments
2. 이전 정상 배포 선택
3. **Rollback** 클릭

---

## 3. 장애 유형별 대응

### 3.1 백엔드 다운 (Critical)

```
1. Railway 로그 확인
2. 최근 배포 변경사항 확인
3. 필요 시 롤백
4. DB 연결 상태 확인
5. 환경 변수 확인
```

### 3.2 DB 연결 실패 (Critical)

```
1. Railway PostgreSQL 서비스 상태 확인
2. DATABASE_URL 환경 변수 확인
3. Flyway 마이그레이션 상태 확인
4. 연결 풀 상태 확인
```

### 3.3 프론트엔드 배포 실패 (Major)

```
1. Cloudflare Pages 빌드 로그 확인
2. 환경 변수 (VITE_API_BASE_URL) 확인
3. 재배포 시도
```

### 3.4 CORS 에러 (Major)

```
1. ALLOWED_ORIGINS 환경 변수 확인
2. SecurityConfig.kt CORS 설정 확인
3. 백엔드 재배포
```

---

## 4. 에스컬레이션

| 시간 | 조치 |
|------|------|
| 0-15분 | 자체 해결 시도 |
| 15-30분 | 추가 리소스 투입 |
| 30분+ | 외부 지원 요청 |

---

## 5. 장애 기록 (Post-mortem)

### 5.1 기록 항목

| 항목 | 내용 |
|------|------|
| 발생 일시 | YYYY-MM-DD HH:MM |
| 복구 일시 | YYYY-MM-DD HH:MM |
| 영향 범위 | 영향받은 기능/사용자 |
| 근본 원인 | 장애 원인 |
| 해결 방법 | 적용한 해결책 |
| 재발 방지 | 개선 조치 |

### 5.2 템플릿

```markdown
## 장애 보고서

**발생 일시**:
**복구 일시**:
**장애 등급**: Critical / Major / Minor

### 증상
-

### 영향 범위
-

### 타임라인
- HH:MM - 장애 감지
- HH:MM - 원인 파악
- HH:MM - 복구 완료

### 근본 원인


### 해결 방법


### 재발 방지 대책

```

---

## 6. 긴급 연락처

| 역할 | 담당 | 연락처 |
|------|------|--------|
| 개발 담당 | - | - |
| 인프라 담당 | - | - |

---

## 7. 복구 체크리스트

### Critical 장애 복구 후

- [ ] 헬스 체크 정상 확인
- [ ] 핵심 API 테스트
- [ ] 프론트엔드 동작 확인
- [ ] 사용자 알림 (필요 시)
- [ ] 장애 보고서 작성

### Major 장애 복구 후

- [ ] 해당 기능 테스트
- [ ] 관련 로그 확인
- [ ] 원인 분석

---

## 변경 이력

| 버전 | 날짜 | 변경 내용 |
|------|------|----------|
| v1.0.0 | 2026-01-28 | 최초 작성 |
