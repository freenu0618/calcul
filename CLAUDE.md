# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## 프로젝트 개요

한국 근로기준법 및 세법에 따른 근로자의 실수령액을 계산하는 웹 기반 급여 계산기입니다.

**목표 사용자**: 영세 사업장 사업주, 근로자, 노무사 보조 도구

**핵심 원칙**: 법적 정확성 > 기능 풍부함. 틀린 계산보다 없는 기능이 낫습니다.

## 기술 스택

- **백엔드**: Python (도메인 주도 설계 적용)
- **프론트엔드**: React + Tailwind CSS + FullCalendar (예정)
- **DB**: PostgreSQL (예정)

## 코드 아키텍처

### 도메인 주도 설계 (DDD) 구조

백엔드는 3계층으로 구성되어 있습니다:

```
backend/app/domain/
├── entities/         # 엔티티 (비즈니스 객체)
│   ├── employee.py      # 근로자 (고용형태, 사업장 규모)
│   ├── work_shift.py    # 근무 시프트 (근로시간 계산)
│   └── allowance.py     # 수당 (과세/비과세, 산입/비산입 구분)
├── value_objects/    # 값 객체 (불변)
│   ├── money.py         # 금액 (Decimal 기반, 원 단위 반올림)
│   └── working_hours.py # 근로시간 (분 단위 정밀 계산)
└── services/         # 도메인 서비스 (순수 함수)
    ├── salary_calculator.py           # 급여 계산 오케스트레이터
    ├── insurance_calculator.py        # 4대 보험 계산
    ├── tax_calculator.py              # 소득세 계산
    ├── overtime_calculator.py         # 연장/야간/휴일 수당 계산
    └── weekly_holiday_pay_calculator.py # 주휴수당 계산
```

### 핵심 설계 원칙

1. **Money 값 객체**: 모든 금액은 `Money` 객체로 다룹니다. Decimal 기반으로 정확한 계산을 보장하며, 모든 금액은 원 단위로 반올림합니다 (`ROUND_HALF_UP`).

2. **WorkingHours 값 객체**: 시간은 **분 단위**로 저장 및 계산하고, 표시 시에만 "시간:분" 형식으로 변환합니다.

3. **야간근로 자동 분리**: `WorkShift.calculate_night_hours()`는 22:00~06:00 구간을 1분 단위로 순회하며 자동 분리합니다.

4. **연장근로 주 단위 계산**: `OvertimeCalculator`는 시프트를 주 단위로 그룹화하여 주 40시간 초과분만 연장근로로 계산합니다 (ISO 주 기준, 월요일 시작).

5. **통상시급 계산**: 통상시급 = 통상임금 ÷ 174시간 (주 40시간 기준 월 소정근로시간). **모든 가산수당은 통상시급 기준으로 계산됩니다.**

6. **수당 분류 시스템**: `Allowance` 엔티티는 4가지 플래그로 수당을 정확히 분류합니다:
   - `is_taxable`: 과세 대상 여부
   - `is_includable_in_minimum_wage`: 최저임금 산입 여부
   - `is_fixed`: 고정 수당 여부
   - `is_included_in_regular_wage`: 통상임금 포함 여부

## 법적 계산 규칙 (2026년 기준)

### 최저임금 산입 기준
- **산입**: 기본급, 고정 직책수당
- **비산입**: 연장·야간·휴일 가산분, 식대(20만원 한도), 실비변상 수당
- **계산식**: 산입임금 기준 시급 = (기본급 + 산입수당) ÷ 월 소정근로시간 (174시간)

### 4대 보험 요율 (2026년)
- 국민연금: 4.5% (상한 590만원, 하한 39만원)
- 건강보험: 3.595%
- 장기요양보험: 건강보험료 × 12.95%
- 고용보험: 0.9% (상한 1350만원)

### 가산수당 계산
- 연장근로: 통상시급 × 1.5배 (주 40시간 초과)
- 야간근로: 통상시급 × 0.5배 (22:00~06:00, 가산분만)
- 휴일근로: 통상시급 × 1.5배 (8시간 이하)
- 휴일근로 8시간 초과: 통상시급 × 2.0배 (5인 이상 사업장만)

### 주휴수당 계산
```
주휴수당 = (1주 소정근로시간 ÷ 40) × 8 × 통상시급
```
- 적용 조건: 주 15시간 이상, 소정근로일 개근
- 5인 미만 사업장도 의무 적용

## 코드 작성 규칙

### 계산 로직
- 모든 계산 함수는 **순수 함수**로 작성 (사이드 이펙트 없음)
- 금액은 `Money` 객체 사용, 연산 후 `.round_to_won()` 호출
- 시간은 `WorkingHours` 객체 사용, 내부적으로 분 단위 저장
- 휴게시간 제외 필수 (`calculate_working_hours()` 메서드에서 자동 처리)

### Docstring 규칙
- 모든 함수/클래스에 docstring 필수
- 계산식이 포함된 경우 Examples 섹션에 명시
- 관련 법 조문 주석 추가 (예: `# 근로기준법 제56조`)

### 검증 규칙
- Entity의 `__post_init__`에서 값 검증 수행
- 음수 방지: 금액, 시간, 부양가족 수 등
- 논리적 일관성 검증: 20세 이하 자녀 수 ≤ 부양가족 수

### 테스트 시나리오 (반드시 포함)
1. 풀타임 주5일 근무 (기본 케이스)
2. 주6일 근무 (주휴수당 정상)
3. 단시간 근로 (주 24시간, 주휴수당 비례)
4. 야간근로 포함 (22:00~06:00 자동 분리)
5. 휴일근로 (일요일 근무)
6. 5인 미만 사업장 (휴일근로 8시간 초과 시 가산율 차이)
7. 최저임금 미달 케이스

## 법적 안전장치

### 경고 메시지 (필수)
- 최저임금 미달: "노동청 신고 가능 사항"
- 연장근로 과다: "주 52시간 위반 가능성"
- 역산 기능: "포괄임금제 오용 주의"

### 면책 조항
모든 계산 결과에 포함:
```
⚠️ 법적 고지
본 계산기는 참고용이며, 실제 급여 지급 시
노무사 또는 세무사와 상담하시기 바랍니다.
계산 결과로 인한 법적 책임은 사용자에게 있습니다.
```

## 참고 문서

- `.claude.md`: 프로젝트 전체 요구사항 및 법적 검토 사항
- `calculator.md`: 상세 요구사항 및 법적 안전장치
- `PLAN.md`: 전체 구현 계획 및 기술 스택

## 현재 구현 상태

### 백엔드 (완료)
- [x] 도메인 모델 설계 (Entity, Value Object)
- [x] 4대 보험 계산 로직
- [x] 연장/야간/휴일 수당 계산 로직
- [x] 주휴수당 계산 로직 (비례 계산 포함)
- [x] 급여 계산 오케스트레이터
- [x] 소득세 계산 로직 (간이세액표 적용)
- [x] REST API 엔드포인트
  - [x] 급여 계산 API (POST /api/v1/salary/calculate)
  - [x] 보험료 조회 API (GET /api/v1/insurance/rates, POST /api/v1/insurance/calculate)
  - [x] 세금 계산 API (POST /api/v1/tax/calculate, POST /api/v1/tax/estimate-annual)
- [x] API 문서화 (Swagger UI, ReDoc, README.md)
- [x] 통합 테스트 (179개 테스트 전체 통과)

### 프론트엔드 (진행 중)
- [x] React + Vite + TypeScript 프로젝트 초기화
- [x] Tailwind CSS 설정 및 기본 스타일
- [x] 프로젝트 폴더 구조 (api/, components/, types/, services/)
- [x] API 클라이언트 레이어 및 TypeScript 타입
- [x] 기본 레이아웃 컴포넌트 (MainLayout, Header, Card, Button)
- [x] 급여 입력 폼 컴포넌트 (EmployeeInfoForm, SalaryForm)
- [x] 계산 결과 표시 컴포넌트 (SalaryResult, GrossBreakdown, DeductionsBreakdown, WarningAlert)
- [x] 급여 계산 API 연동 (App.tsx)
- [x] 근무 시프트 입력 연동 (ShiftInput → App.tsx 연동 완료)

### 향후 개발 계획
- [ ] 법정 요율 JSON 관리 (연도별 버전 관리)
- [ ] 캘린더 UI (FullCalendar)
- [x] 시프트 템플릿 기능 (풀타임 주4/5/6, 오전/오후/야간조 프리셋)
- [ ] 데이터베이스 연동 (PostgreSQL)
- [ ] 고급 기능
  - [ ] 역산 기능 (Net → Gross)
  - [ ] 급여명세서 PDF 출력
  - [ ] 최저임금 미달/주 52시간 위반 경고

## 중요 알림

- **계산식 투명성**: API 응답에 모든 계산 과정을 포함 (`to_dict()` 메서드의 `calculation` 필드 참조)
- **경고는 과도하게**: 법적 리스크가 있으면 반드시 경고 표시
- **매년 업데이트 필요**: 보험료율/최저임금은 매년 1월 변경됨 (DB 버전 관리 필수)
- **코드 작성 가이드**: 파일당 200줄이 넘어가지 않게 작성할것(God Object방지), 최대한 간결하고 깔끔하게 작성하고 tyding 코딩할것
## 문서 보관
- **본 프로젝트의 의미**: 본 프로젝트는 취업을 위한 포트폴리오용 프로젝트이므로 프로젝트 기획서, 사용기술 목록/경험, 개발스케줄, 요구사항 정의서 및 명세서, 화면 설계서, UML, 결과 보고서, 주요 서비스 기능 및 소스코드, 테스트 코드, 테스트 결과, 소프트웨어 아키텍처, 향후 개발 계획등을 문서로 정리하여 보관합니다.
- **문서 보관 위치**: clacul/docs폴더에 문서를 정리하여 보관합니다.

[범위]
- 문제 해결과 구현에 필요한 핵심파일만만

[목표]
- 문제 해결

[제약]
- 설명 최소
- 코드 중심
- 불필요한 리팩토링 금지
